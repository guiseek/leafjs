function t(t,e,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(t):s?s.value:e.get(t)}function e(t,e,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(t,r):o?o.value=r:e.set(t,r),r}class r{constructor(){this.activeEffects=[],this.onChange=null,this.isSetting=!1,this.actualState=void 0}getTrackableObject(t,e){for(const r in t)t[r]&&"object"==typeof t[r]&&(t[r]=this.getTrackableObject(t[r],e));const r=this,s=new Proxy(t,{get(t,r,s){const o=Reflect.get(t,r,s);return e.onGet(t,r,s),o},set(t,s,o,n){"object"==typeof o&&(o=r.getTrackableObject(o,e));const i=Reflect.set(t,s,o,n);return e.onSet(t,s,o,n),i},deleteProperty(t,r){const s=Reflect.deleteProperty(t,r);return e.onDeleteProperty(t,r),s}});return Array.isArray(t)&&Object.setPrototypeOf(s,Array.prototype),s}build(t){const e=this,r=()=>{this.isSetting?setTimeout(r,2):this.onChange&&this.onChange()};return this.actualState=this.getTrackableObject(t,{onGet(){},onSet(){e.isSetting||(e.isSetting=!0,r()),e.isSetting=!1},onDeleteProperty(){}}),this.actualState}onStateChange(t){this.onChange=t,t()}}const s=new WeakMap,o=t=>HTMLCollection.prototype.isPrototypeOf(t)||NodeList.prototype.isPrototypeOf(t)||Array.isArray(t),n=(t,e,r)=>(customElements.define(t,e,r),s.set(e,t),e),i={className:"class"},a=t=>!1===t||null==t,c=(t,e)=>{if(o(e))for(const r of e)a(r)||(Array.isArray(r)?c(t,r):t.append(r));else t.append(e)};var h,l,p,f,u,d,y,g;const m=new WeakMap,w=[{name:"value",attr:"value"}],v=new Map,b=(t,e)=>t.startsWith("on"),A=t=>t.nodeType===Node.ELEMENT_NODE,E=t=>!0===t.isLeafComponent,C=t=>t.nodeType===Node.TEXT_NODE,P=t=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t,S=(t,e,r)=>{if("string"!=typeof t){const e=s.get(t);if(!e)throw new Error("Unable to fetch component from registery.");t=e}const o=document.createElement(t),n=new Set;for(const t in e){const r=e[t];if(b(t)){const e=t.substring(2).toLowerCase();n.add({name:e,handler:r}),o.addEventListener(e,r)}else E(o)&&(o.props[t]=r,!P(r))||(t in i?o.setAttribute(i[t],r):o.setAttribute(t,r))}return m.set(o,n),r&&c(o,r),o},T=(t,e,r)=>void 0===e?S(t):(t=>void 0!==t.nodeType||"string"==typeof t||"number"==typeof t)(e)||o(e)?S(t,r,e):S(t,e),k=(t,e,...r)=>r?T(t,r,null!=e?e:{}):T(t,null!=e?e:{}),N=t=>{if(m.has(t))return m.get(t)},M=(t,e)=>{m.set(t,e||new Set)},L=t=>m.delete(t),x=(t,e)=>{if(o(t))for(const r of t)Array.isArray(r)?x(r,e):e(r);else e(t)},$=(t,e)=>{t.forEach((t=>{e.appendChild(t)}))},O=(t,e,r,s)=>{if(!r)return;let o=t.length,n=e.length;if(A(r)&&A(s)){const t=N(r),e=N(s);null==t||t.forEach((t=>{r.removeEventListener(t.name,t.handler)})),null==e||e.forEach((t=>{r.addEventListener(t.name,t.handler)})),M(r,e),L(s)}for(let s=0,i=0;Math.max(s,i)<Math.min(o,n);s++,i++){let n=t[s];const a=e[i];if(A(n)&&n.hasAttribute("leaf-preserve")&&(n=t[++s],o--),E(n)&&(n.isUpdating=!0),E(a)&&(a.isUpdating=!0),A(n)&&A(a)){const t=Array.prototype.slice.call(n.attributes),e=Array.prototype.slice.call(a.attributes);for(const t of e)if(P(t.value)&&n.getAttribute(t.name)!==t.value){n.setAttribute(t.name,t.value);for(const e of w)e.name===t.name&&(n[e.name]=t.value)}for(const e of t)a.hasAttribute(e.name)||n.removeAttribute(e.name)}if(A(n)&&A(a)&&n.tagName!==a.tagName){let t=n.previousSibling;if(n.outerHTML=n.outerHTML.replace(new RegExp(`<${n.tagName.toLowerCase()}(.*?)`,"g"),`<${a.tagName.toLowerCase()}$1`).replace(new RegExp(`</${n.tagName.toLowerCase()}(.*?)`,"g"),`</${a.tagName.toLowerCase()}$1`),n=t?t.nextSibling:r.firstChild,!A(n))continue;E(n)&&(n.isUpdating=!0)}if(E(n)&&E(a)){for(const t of a.attributes)t.name in a.props||(n.props[t.name]=t.value);for(const t in a.props)n.props[t]=a.props[t];for(const t in n.props)t in a.props||a.hasAttribute(t)||delete n.props[t]}if(C(n)&&C(a)){if(n.textContent===a.textContent)continue;r.replaceChild(a,n)}else C(n)&&A(a)&&(r.replaceChild(a,n),n=a,E(n)&&(n.isUpdating=!0)),A(n)&&C(a)?r.replaceChild(a,n):(O(Array.from(n.childNodes),Array.from(a.childNodes),n,a),E(n)&&(n.isUpdating=!1,n.rerender()))}n>o?e.slice(o).forEach((t=>{t.nodeType!==Node.TEXT_NODE?$([t],r):r.appendChild(t)})):n<o&&t.slice(n).forEach((t=>{r.removeChild(t)}))},R=(t,...e)=>{let r="",s=0;return t.forEach((t=>{r+=t+e[s++]})),r};class j extends HTMLElement{constructor(){super(),h.add(this),l.set(this,null),p.set(this,null),f.set(this,null),u.set(this,null),d.set(this,void 0),y.set(this,!1),this.props={},this.isLeafComponent=!0,this.isUpdating=!1;const e={};for(const t of this.constructor.observedAttributes)e[t]=null;const r=this,s=(t,e)=>{if(!this.constructor.observedAttributes.includes(t))throw new Error(`Unknown property ${t}. Expected one of ${this.constructor.observedAttributes.map((t=>`'${t}'`)).join(", ")}.`);if(!Array.isArray(this.constructor.watchedProps)&&t in this.constructor.watchedProps&&null!=e&&!this.isUpdating&&this.constructor.watchedProps[t]!==e.constructor)throw new TypeError(`Types of property '${t}' unmatch: expected ${this.constructor.watchedProps[t].name}, got ${e.constructor.name}`)},o={name:"",value:null};this.props=new Proxy(e,{get:(t,e,r)=>(s(e),Reflect.get(t,e,r)),set(e,n,i,a){s(n,i);const c=Reflect.set(e,n,i,a);return!t(r,y,"f")||"key"===n||o.name===n&&o.value===i||(r.onPropChange(n,i),o.name=n,o.value=i),t(r,y,"f")&&r.rerender(),c},has:(t,e)=>r.constructor.observedAttributes.includes(e),deleteProperty:(t,e)=>(s(e),Reflect.deleteProperty(t,e))})}static get observedAttributes(){const t=[];if(Array.isArray(this.watchedProps))t.push(...this.watchedProps);else for(const e in this.watchedProps)t.push(e);return[...t,"key"]}setState(t){e(this,l,t,"f")}getState(){return t(this,y,"f")?t(this,l,"f"):{}}get state(){return this.getState()}set state(t){this.setState(t)}get listeners(){return Array.from(N(this)||[])}fireEvent(t,e){if(t instanceof Event)return t.stopPropagation(),this.fireEvent(t.type,e);const r=new CustomEvent(t,{detail:e});return this.dispatchEvent(r)}rerender(){var r;if(!t(this,u,"f")||this.isUpdating||!t(this,y,"f")||(null===(r=t(this,p,"f"))||void 0===r?void 0:r.isSetting))return;t(this,p,"f")&&(t(this,p,"f").isSetting=!0),t(this,f,"f")?this.onRerender():this.onMounted();let s=this.render();if(Array.isArray(s)||(s=[s]),t(this,p,"f")&&(t(this,p,"f").isSetting=!1),!t(this,f,"f"))return $(s,t(this,u,"f")),void e(this,f,s,"f");O(Array.from(t(this,u,"f").childNodes),Array.from(s),t(this,u,"f"),s[0]),e(this,f,s,"f")}onMounted(){}onRerender(){}onPropChange(t,e){}connectedCallback(){var s,o,n,i,a;e(this,y,!0,"f"),e(this,u,this.attachShadow({mode:"closed"}),"f");const c=T("style"),f=null!==(s=this.css)&&void 0!==s?s:t(this,h,"m",g);c.textContent=f(),c.setAttribute("leaf-preserve","true"),t(this,u,"f").appendChild(c);const m=v.get(t(this,d,"f")||"");e(this,p,m||new r,"f"),(null===(o=t(this,p,"f"))||void 0===o?void 0:o.actualState)?e(this,l,t(this,p,"f").actualState,"f"):e(this,l,null===(n=t(this,p,"f"))||void 0===n?void 0:n.build(null!==(i=t(this,l,"f"))&&void 0!==i?i:{}),"f"),t(this,p,"f")&&t(this,d,"f")&&v.set(t(this,d,"f"),t(this,p,"f")),null===(a=t(this,p,"f"))||void 0===a||a.onStateChange((()=>this.rerender()))}attributeChangedCallback(t,r,s){r!==s&&("key"===t&&e(this,d,s,"f"),Array.isArray(this.constructor.watchedProps)?this.props[t]=s:this.constructor.watchedProps[t]===Number?this.props[t]=parseFloat(s):this.props[t]=s)}render(){throw new Error("Render function of `LeafComponent` must be overrided.")}css(){return""}}l=new WeakMap,p=new WeakMap,f=new WeakMap,u=new WeakMap,d=new WeakMap,y=new WeakMap,h=new WeakSet,g=function(){return""},j.watchedProps=[];export{j as LeafComponent,r as Reactive,T as createElement,k as createElementReactStyle,R as css,L as deleteEventListenerOf,w as directPropUpdate,m as eventListeners,N as getEventListenerOf,A as isElement,b as isEventListener,P as isValidAttribute,$ as mountElements,O as patchElements,v as reactiveInstances,n as registerComponent,x as runCallbackOnElements,M as setEventListenerOf};
//# sourceMappingURL=leaf.min.js.map
