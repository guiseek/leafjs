function t(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)}function e(t,e,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(t,r):s?s.value=r:e.set(t,r),r}class r{constructor(){this.activeEffects=[],this.onChange=null,this.isSetting=!1,this.actualState=void 0}getTrackableObject(t,e){for(const r in t)t[r]&&"object"==typeof t[r]&&(t[r]=this.getTrackableObject(t[r],e));const r=this,n=new Proxy(t,{get(t,r,n){const s=Reflect.get(t,r,n);return e.onGet(t,r,n),s},set(t,n,s,o){"object"==typeof s&&(s=r.getTrackableObject(s,e));const i=Reflect.set(t,n,s,o);return e.onSet(t,n,s,o),i},deleteProperty(t,r){const n=Reflect.deleteProperty(t,r);return e.onDeleteProperty(t,r),n}});return Array.isArray(t)&&Object.setPrototypeOf(n,Array.prototype),n}build(t){const e=this,r=()=>{this.isSetting?setTimeout(r,2):this.onChange&&this.onChange()};return this.actualState=this.getTrackableObject(t,{onGet(){},onSet(){e.isSetting||(e.isSetting=!0,r()),e.isSetting=!1},onDeleteProperty(){}}),this.actualState}onStateChange(t){this.onChange=t,t()}}const n=new WeakMap,s=t=>HTMLCollection.prototype.isPrototypeOf(t)||NodeList.prototype.isPrototypeOf(t)||Array.isArray(t),o=(t,e,r)=>(customElements.define(t,e,r),n.set(e,t),e),i={className:"class"},a=t=>!1===t||null==t,l=(t,e)=>{if(s(e))for(const r of e)a(r)||(Array.isArray(r)?l(t,r):t.append(r));else t.append(e)};var f,h,c,d,p,u,g,y;const m=new WeakMap,b=[{name:"value",attr:"value"}],v=new Map,w=(t,e)=>t.startsWith("on"),E=t=>t.nodeType===Node.ELEMENT_NODE,A=t=>!0===t.isLeafComponent,C=t=>t.nodeType===Node.TEXT_NODE,S=t=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t,T=(t,e,r)=>{if("string"!=typeof t){const e=n.get(t);if(!e)throw new Error("Unable to fetch component from registery.");t=e}const s=document.createElement(t),o=new Set;for(const t in e){const r=e[t];if(w(t)){const e=t.substring(2).toLowerCase();o.add({name:e,handler:r}),s.addEventListener(e,r)}else A(s)&&(s.props[t]=r,!S(r))||(t in i?s.setAttribute(i[t],r):s.setAttribute(t,r))}return m.set(s,o),r&&l(s,r),s},k=(t,e,r)=>void 0===e?T(t):(t=>void 0!==t.nodeType||"string"==typeof t||"number"==typeof t)(e)||s(e)?T(t,r,e):T(t,e),M=(t,e,...r)=>r?k(t,r,null!=e?e:{}):k(t,null!=e?e:{}),N=t=>{if(m.has(t))return m.get(t)},L=(t,e)=>{m.set(t,e||new Set)},P=t=>m.delete(t),x=(t,e)=>{if(s(t))for(const r of t)Array.isArray(r)?x(r,e):e(r);else e(t)},O=(t,e)=>{t.forEach((t=>{e.appendChild(t)}))},R=(t,e,r,n)=>{if(!r)return;let s=t.length,o=e.length;if(E(r)&&E(n)){const t=N(r),e=N(n);null==t||t.forEach((t=>{r.removeEventListener(t.name,t.handler)})),null==e||e.forEach((t=>{r.addEventListener(t.name,t.handler)})),L(r,e),P(n)}for(let n=0,i=0;Math.max(n,i)<Math.min(s,o);n++,i++){let o=t[n];const a=e[i];if(E(o)&&o.hasAttribute("leaf-preserve")&&(o=t[++n],s--),A(o)&&(o.isUpdating=!0),A(a)&&(a.isUpdating=!0),E(o)&&E(a)){const t=Array.prototype.slice.call(o.attributes),e=Array.prototype.slice.call(a.attributes);for(const t of e)if(S(t.value)&&o.getAttribute(t.name)!==t.value){o.setAttribute(t.name,t.value);for(const e of b)e.name===t.name&&(o[e.name]=t.value)}for(const e of t)a.hasAttribute(e.name)||o.removeAttribute(e.name)}if(E(o)&&E(a)&&o.tagName!==a.tagName){let t=o.previousSibling;if(o.outerHTML=o.outerHTML.replace(new RegExp(`<${o.tagName.toLowerCase()}(.*?)`,"g"),`<${a.tagName.toLowerCase()}$1`).replace(new RegExp(`</${o.tagName.toLowerCase()}(.*?)`,"g"),`</${a.tagName.toLowerCase()}$1`),o=t?t.nextSibling:r.firstChild,!E(o))continue;A(o)&&(o.isUpdating=!0)}if(A(o)&&A(a)){for(const t of a.attributes)o.props[t.name]=t.value;for(const t in a.props)o.props[t]=a.props[t];for(const t in o.props)t in a.props||a.hasAttribute(t)||delete o.props[t]}if(C(o)&&C(a)){if(o.textContent===a.textContent)continue;r.replaceChild(a,o)}else C(o)&&E(a)&&(r.replaceChild(a,o),o=a,A(o)&&(o.isUpdating=!0)),E(o)&&C(a)?r.replaceChild(a,o):(R(Array.from(o.childNodes),Array.from(a.childNodes),o,a),A(o)&&(o.isUpdating=!1,o.rerender()))}o>s?e.slice(s).forEach((t=>{t.nodeType!==Node.TEXT_NODE?O([t],r):r.appendChild(t)})):o<s&&t.slice(o).forEach((t=>{r.removeChild(t)}))},j=(t,...e)=>{let r="",n=0;return t.forEach((t=>{r+=t+e[n++]})),r};class W extends HTMLElement{constructor(){super(),f.add(this),h.set(this,null),c.set(this,null),d.set(this,null),p.set(this,null),u.set(this,void 0),g.set(this,!1),this.props={},this.isLeafComponent=!0,this.isUpdating=!1;const e={};for(const t of this.constructor.observedAttributes)e[t]=null;const r=this,n=t=>{if(!this.constructor.observedAttributes.includes(t))throw new Error(`Unknown property ${t}. Expected one of ${this.constructor.observedAttributes.map((t=>`'${t}'`)).join(", ")}.`)};this.props=new Proxy(e,{get:(t,e,r)=>(n(e),Reflect.get(t,e,r)),set(e,s,o,i){n(s),S(o)&&r.setAttribute(s,o.toString());const a=Reflect.set(e,s,o,i);return t(r,g,"f")&&r.rerender(),a},has:(t,e)=>r.constructor.observedAttributes.includes(e),deleteProperty:(t,e)=>(n(e),Reflect.deleteProperty(t,e))})}static get observedAttributes(){return[...this.watchedProps,"key"]}get state(){if(t(this,g,"f"))return t(this,h,"f")}set state(t){e(this,h,t,"f")}get listeners(){return Array.from(N(this)||[])}fireEvent(t,e){if(t instanceof Event)return t.stopPropagation(),this.fireEvent(t.type,e);const r=new CustomEvent(t,{detail:e});return this.dispatchEvent(r)}rerender(){var r;if(!t(this,p,"f")||this.isUpdating||!t(this,g,"f")||(null===(r=t(this,c,"f"))||void 0===r?void 0:r.isSetting))return;t(this,c,"f")&&(t(this,c,"f").isSetting=!0),t(this,d,"f")?this.onRerender():this.onMounted();let n=this.render();if(Array.isArray(n)||(n=[n]),t(this,c,"f")&&(t(this,c,"f").isSetting=!1),!t(this,d,"f"))return O(n,t(this,p,"f")),void e(this,d,n,"f");R(Array.from(t(this,p,"f").childNodes),Array.from(n),t(this,p,"f"),n[0]),e(this,d,n,"f")}onMounted(){}onRerender(){}connectedCallback(){var n,s,o,i,a;e(this,g,!0,"f"),e(this,p,this.attachShadow({mode:"closed"}),"f");const l=k("style"),d=null!==(n=this.css)&&void 0!==n?n:t(this,f,"m",y);l.textContent=d(),l.setAttribute("leaf-preserve","true"),t(this,p,"f").appendChild(l);const m=v.get(t(this,u,"f")||"");e(this,c,m||new r,"f"),(null===(s=t(this,c,"f"))||void 0===s?void 0:s.actualState)?e(this,h,t(this,c,"f").actualState,"f"):e(this,h,null===(o=t(this,c,"f"))||void 0===o?void 0:o.build(null!==(i=t(this,h,"f"))&&void 0!==i?i:{}),"f"),t(this,c,"f")&&t(this,u,"f")&&v.set(t(this,u,"f"),t(this,c,"f")),null===(a=t(this,c,"f"))||void 0===a||a.onStateChange((()=>this.rerender()))}attributeChangedCallback(t,r,n){r!==n&&("key"===t&&e(this,u,n,"f"),this.rerender())}render(){throw new Error("Render function of `LeafComponent` must be overrided.")}css(){return""}}h=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,u=new WeakMap,g=new WeakMap,f=new WeakSet,y=function(){return""},W.watchedProps=[];export{W as LeafComponent,r as Reactive,k as createElement,M as createElementReactStyle,j as css,P as deleteEventListenerOf,b as directPropUpdate,m as eventListeners,N as getEventListenerOf,E as isElement,w as isEventListener,S as isValidAttribute,O as mountElements,R as patchElements,v as reactiveInstances,o as registerComponent,x as runCallbackOnElements,L as setEventListenerOf};
//# sourceMappingURL=leaf.min.js.map
